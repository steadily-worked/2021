<리액트를 다루는 기술>을 요약한 글입니다.

## render 함수

```js
render() { ... }
```

# React

## 초기 렌더링

어떤 UI 관련 프레임워크, 라이브러리를 사용하든지 간에 맨 처음 어떻게 보일지를 정하는 초기 렌더링이 필요하다. 리액트에서는 이를 다루는 `render` 함수가 있다.

이 함수는 컴포넌트가 어떻게 생겼는지 정의하는 역할을 한다. HTML 형식의 문자열을 반환하지 않고, 뷰가 어떻게 생겼고 어떻게 작동하는지에 대한 정보를 지닌 객체를 반환한다. 컴포넌트 내부에는 또 다른 컴포넌트들이 들어갈 수 있다. 이 때 `render` 함수를 실행하면 그 내부에 있는 컴포넌트들도 재귀적으로 렌더링한다. 이렇게 최상위 컴포넌트의 렌더링 작업이 끝나면 지니고 있는 정보들을 사용하여 HTML 마크업을 만들고, 이를 우리가 정하는 실제 페이지의 DOM 요소 안에 주입한다.

<img width="436" alt="스크린샷 2021-02-15 오후 1 04 52" src="https://user-images.githubusercontent.com/61453718/107904191-66764c00-6f8e-11eb-90f7-4c8612244452.png">

`render` 함수는 뷰가 어떻게 생겼고, 어떻게 작동하는지 객체를 반환한다고 했었다. 컴포넌트는 데이터를 업데이트했을 때 단순히 업데이트한 값을 수정하는 것이 아니라, 새로운 데이터를 가지고 `render` 함수를 또 다시 호출한다. 그러면 그 데이터를 지닌 뷰를 생성해 낸다.

하지만 이 때 `render` 함수가 반환하는 결과를 곧바로 DOM에 반영하지 않고 이전에 `render` 함수가 만들었던 컴포넌트 정보와 현재 `render` 함수가 만든 컴포넌트 정보를 비교한다.

<img width="619" alt="스크린샷 2021-02-15 오후 1 14 47" src="https://user-images.githubusercontent.com/61453718/107904663-cae5db00-6f8f-11eb-9442-8c250b019d8f.png">

자바스크립트를 사용하여 두 가지 뷰를 최소한의 연산으로 비교한 후, 둘의 차이를 알아내 최소한의 연산으로 DOM 트리를 업데이트하는 것이다.

<img width="279" alt="스크린샷 2021-02-15 오후 1 17 56" src="https://user-images.githubusercontent.com/61453718/107904808-3a5bca80-6f90-11eb-916d-b7c6cdec363f.png">

결국 방식 자체는 루트 노드부터 시작하여 전체 컴포넌트를 처음부터 다시 렌더링하는 것처럼 보이지만, 사실 최적의 자원을 사용하여 이를 수행하는 것이다.

## Virtual DOM

- 리액트의 주요 특징 중 하나는 Virtual DOM을 사용하는 것이다.

### DOM이란?

DOM은 Document Object Mode의 약어로, 객체로 문서 구조를 표현하는 방법을 말한다. 방법으로는 `XML`이나 `HTML`로 작성한다.

웹 브라우저는 DOM을 활용하여 객체에 자바스크립트와 CSS를 적용한다. DOM은 트리 형태라서 특정 노드를 찾거나 수정하거나 제거하거나 원하는 곳에 삽입할 수 있다.

<img width="559" alt="스크린샷 2021-02-15 오후 1 25 07" src="https://user-images.githubusercontent.com/61453718/107905135-3a0fff00-6f91-11eb-9b8a-8ef7f1082aee.png">

DOM은 과연 느릴까?

요즘 DOM API를 수많은 플랫폼과 웹 브라우저에서 사용하는데, 이 DOM에는 치명적인 한 가지 문제점이 있다. 바로 동적 UI에 최적화되어 있지 않다는 것이다. HTML은 자체적으로는 정적이다. 자바스크립트를 이용하여 이를 동적으로 만들 수 있다.

but 규모가 커지면 문제가 되는데, 수많은 데이터가 로딩되므로 당연히 느려지게 된다. DOM 자체는 빠르지만, 웹 브라우저 단에서 DOM에 변화가 일어나면 웹 브라우저가 다시 CSS를 연산하고, 레이아웃을 구성하고, 페이지를 리페인트한다. 이 과정에서 시간이 허비되는 것이다.

이런 문제를 해결하려면 DOM을 아예 조작하지 않을 수 없다. 그 대신 DOM을 최소한으로 조작하여 작업을 처리하는 방식으로 개선할 수 있다.

리액트는 Virtual DOM 방식을 사용하여 DOM 업데이트를 추상화함으로써 DOM 처리 횟수를 최소화하고 효율적으로 진행한다.
Virtual DOM을 사용하면 실제 DOM에 접근하여 조작하는 대신, 이를 추상화한 자바스크립트 객체를 구성하여 사용한다. 마치 실제 DOM의 가벼운 사본과 비슷하다.

리액트에서 데이터가 변하여 웹 브라우저에 실제 DOM을 업데이트할 때는 다음 세 가지 절차를 밟는다.

1. 데이터를 업데이트하면 전체 UI를 Virtual DOM에 리렌더링한다.
2. 이전 Virtual DOM에 있던 내용과 현재 내용을 비교한다.
3. 바뀐 부분만 실제 DOM에 적용한다.

<img width="623" alt="스크린샷 2021-02-15 오후 1 35 43" src="https://user-images.githubusercontent.com/61453718/107905718-b525e500-6f92-11eb-9ffd-a1acef776aec.png">

여기서 오른쪽의 `새로운 DOM 트리`가 바로 Virtual DOM이다.

## 기타 특징

일부 웹 프레임워크가 MVC 또는 MVW 등의 구조를 지향하는 것과 달리 리액트는 오직 뷰만 담당한다. 다시 한 번 강조하면 리액트는 프레임워크가 아니라 라이브러리다. 다른 웹 프레임워크가 Ajax, 데이터 모델링, 라우팅 등과 같은 기능을 내장하고 있는 반면, 리액트는 정말 뷰만 신경 쓰는 라이브러리이므로 기타 기능은 직접 구현하여 사용해야 한다.

하지만 그렇다고 너무 걱정할 필요는 없다. 다른 개발자들이 만든 라이브러리, 즉 라우팅에는 리액트 라우터(react-router), Ajax 처리에는 axios나 fetch, 상태 관리에는 리덕스(redux)나 MobX를 사용하여 빈 자리를 채우면 된다. 해당 분야에서 마음에 드는 라이브러리를 사용하면 되니까 자신의 취향대로 스택을 설정할 수 있다는 장점이 있지만, 여러 라이브러리를 접해야 한다는 단점도 있다.

<img width="314" alt="스크린샷 2021-02-15 오후 1 39 23" src="https://user-images.githubusercontent.com/61453718/107905924-38dfd180-6f93-11eb-97f6-c102dc9241a4.png">

또 리액트는 다른 웹 프레임워크나 라이브러리와 혼용할 수도 있다. 예를 들어 Backbone.js, AngularJS 등의 프레임워크와 함께 언제든지 사용할 수 있다.

<img width="313" alt="스크린샷 2021-02-15 오후 1 40 28" src="https://user-images.githubusercontent.com/61453718/107905972-5f057180-6f93-11eb-8a5b-3ae4179e5e85.png">
