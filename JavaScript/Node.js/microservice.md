<Node.js 마이크로서비스 코딩 공작소>를 요약함과 동시에 제 나름대로의 생각을 적은 글입니다.

# Node.js

## 2. 마이크로서비스 아키텍처

### 2-1. 마이크로서비스란

커다란 모놀리식 아키텍처를 단독으로 실행 가능한 다수의 모듈로 분해한 아키텍처를 마이크로서비스 아키텍처라고 한다. 이때 실행 가능한 하나의 모듈을 마이크로서비스라고 한다.

각각의 마이크로서비스는 독립적인 프로세스 형태로 각기 배포할 수 있어야 하고, 개별적으로도 개발할 수 있어야 한다. 마이크로서비스는 상호 독립적인 구조이기 때문에 프로그래밍 언어나 프레임워크가 같을 필요는 없으며, 서로 독립적인 데이터 저장소와 네트워크 통신 기능을 가질 수 있다.

마이크로서비스의 특징을 정리하면 다음과 같다.

```
- 마이크로서비스 하나는 독립적인 프로세스 하나를 의미한다.
- 개발과 배포에 상호 독립적이다.
- 기술 독립성을 가진다.
- 독립적인 데이터 저장소를 가질 수 있다.
- 각 마이크로서비스는 각자 가진 네트워크 기능으로 통신할 수 있다.
```

예를 들어, `회원 관리`, `상품 관리`, `구매 관리` 각각에 대한 I/O와 데이터 저장소를 가지게끔 구성할 수 있다는 것이다.

모놀리식 아키텍처의 문제 대부분은 모든 기능을 하나의 프로세스로 개발하는 것에서 발생한다. 관리하기 적당한 작은 단위로 기능을 분리하면 앞에서 언급한 문제점인 비효율적인 분산 처리와 코드의 복잡성을 해결할 수 있고, 기능별 최적화된 언어 및 프레임워크도 사용할 수 있다.

### 2-2. 마이크로서비스 아키텍처의 단점

마이크로서비스 아키텍처는 모놀리식 아키텍처의 문제점을 해결할 수 있는 좋은 대안이지만, 장점만 있지는 않다.

#### 1. 공유 자원 접근이 어렵다.

예를 들어, 구매 관리 마이크로서비스가 회원 관리 마이크로서비스의 데이터를 참조해야 한다고 가정하자. 모놀리식 아키텍처라면 프로세스가 같기 때문에 어렵지 않게 구매 관리 로직에서 회원 관리 로직으로 접근할 수 있다. 하지만 마이크로서비스에서는 서로 다른 프로세스로 실행하기 때문에 추가적인 고민이 필요하다. 공유 자원을 처리하는 방법은 이후에 다룬다.

#### 2. 배포와 실행이 복잡해진다.

모놀리식 아키텍처에서는 프로세스 하나만 실행해도 서비스가 가능했지만, 마이크로서비스는 복잡한 실행 과정을 거쳐야만 정상적인 서비스가 가능하다. 배포 자동화 역시 이후에 다룬다.

#### 3. 분산 시스템을 구현하기 어렵다.

마이크로서비스에는 독립적인 프로세스들을 유기적으로 동작할 수 있게 하는 분산 네트워크 시스템이 필요하다. 매우 중요한 시스템이지만 네트워크 레벨에서 다양한 상황별로 처리해야 하므로 구현하기 어려울 수 있다. 분산 아키텍처 역시 이후에 다룬다.

### 2-3. 마이크로서비스와 Node.js

마이크로서비스 아키텍처에는 여러 마이크로서비스가 유기적으로 동작해야 하므로 마이크로서비스 하나는 구조가 작고 가벼워야 한다. 유지 보수와 배포가 어렵고 장애 포인트가 많다면, 마이크로서비스 아키텍처는 아무런 장점이 없는 아키텍처이다.

코드 구조를 작고 가볍게 하는 데 어떤 요소가 가장 중요할까? 대부분의 서비스는 정보를 저장하고 조회하는 데 데이터베이스, 파일 등과의 I/O가 필수적이다. 그런데 이때 I/O가 동기 방식이라면 응답이 올 때까지 다음 요청을 처리하지 못하기 때문에 성능이 좋지 않다. 보통 이러한 문제는 메시지 - 큐를 이용해 해결한다. I/O를 실제로 처리하는 서버를 별도로 두고, 요청을 받은 서버는 큐로 데이터를 전송한 후 이 요청을 처리하고, I/O가 처리되면 클라이언트에 보내는 방식을 사용한다.

요청을 받는 서버와 I/O를 처리하는 서버, 메시지-큐를 처리하는 프로세스까지 모두 고려해서 마이크로서비스를 구현해야 한다면, 개발량도 많고 코드 구조도 복잡해 배포 또한 쉽지 않다.

Node.js는 내부적으로 이러한 매커니즘을 모두 처리해 주기 때문에 개발자가 별도로 고민하지 않아도 된다.

이외에도 Node.js는 싱글 스레드를 기반으로 코딩하기 때문에 스레드 동기화와 교착 상태 등을 고려할 필요가 없다. 또 자바스크립트를 사용하기 때문에 문법이 쉽다는 장점이 있어 마이크로서비스를 구현하는 데 좋은 선택이 될 수 있다.

다음 장에서 Node.js를 간단히 살펴본 후 Node.js로 모놀리식 아키텍처를 만들어 볼 것이다.

### 2-4. 정리

#### 마이크로서비스

    • 마이크로서비스 하나는 독립적인 프로세스 하나를 의미한다.
    • 개발과 배포에 상호 독립적이다.
    • 기술 독립성을 가진다.
    • 독립적인 데이터 저장소를 가질 수 있다.
    • 각 마이크로서비스는 각자 가진 네트워크 기능으로 통신할 수 있다.

#### 마이크로서비스 아키텍처 구현의 어려움

    • 공유 자원 접근이 어렵다.
    • 배포와 실행이 복잡하다.
    • 분산 시스템을 구현하기 어렵다.

#### 마이크로서비스와 Node.js

    • Node.js에는 메시지-큐 기능이 자체적으로 들어 있다.
    • Node.js는 경량화된 고성능 서버 개발에 최적화된 프레이워크이다.
